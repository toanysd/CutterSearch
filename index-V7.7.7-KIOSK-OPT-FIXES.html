<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÈáëÂûã„ÉªÊäúÂûãÊ§úÁ¥¢„Ç∑„Çπ„ÉÜ„É† V7.7.7-KIOSK-OPT | Mold & Cutter Search System</title>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="styles-V7.7.7-KIOSK-OPT-FIXES.css">
    <link rel="stylesheet" href="keyboard-panel.css">
    <link rel="stylesheet" href="styles-lower-section.css" />


    <!-- External Libraries (CDN) -->
    <!-- QR Code Scanner (Html5-QRCode) -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>

    <!-- QR Code Generator -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <!-- ========================================
         HEADER - Desktop/iPad (OPTIMIZED)
         ======================================== -->
    <header class="app-header">
        <div class="header-title">
            <div class="title-main">
                <i class="fas fa-search"></i>
                <span>ÈáëÂûã„ÉªÊäúÂûãÊ§úÁ¥¢„Ç∑„Çπ„ÉÜ„É†</span>
                <span class="version-badge">V7.7.5-OPT</span>
            </div>
            <!-- THAY ƒê·ªîI: Ti·∫øng Vi·ªát italic -->
            <div class="title-sub">H·ªá th·ªëng t√¨m ki·∫øm khu√¥n v√† dao c·∫Øt</div>
        </div>

        <div class="header-status">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span>Ê∫ñÂÇôÂÆå‰∫Ü</span>
            </div>
            <div class="status-counts">
                <span>ÈáëÂûã: <strong id="mold-count">4518</strong></span>
                <span class="divider">|</span>
                <span>ÊäúÂûã: <strong id="cutter-count">1665</strong></span>
            </div>
        </div>
    </header>

    <!-- ========================================
         MOBILE STICKY HEADER (iPhone only)
         ======================================== -->
    <div class="mobile-header">
        <div class="mobile-search-row">
            <div class="mobile-search-box">
                <input type="text" class="mobile-search-input" placeholder="„Ç≥„Éº„Éâ„ÉªÂêçÂâç„ÉªÂØ∏Ê≥ï„ÅßÊ§úÁ¥¢..." id="mobile-search-input">
                <button class="mobile-clear-btn" id="mobile-clear-btn"><i class="fas fa-times"></i></button>
            </div>
            <button class="mobile-qr-btn" id="mobile-qr-btn"><i class="fas fa-qrcode"></i></button>
        </div>

        <div class="mobile-actions-row">
            <button class="mobile-action-btn checkin" id="mobile-checkin-btn">
                <i class="fas fa-box"></i>
                <span>ÂÖ•Â∫´</span>
            </button>
            <button class="mobile-action-btn checkout" id="mobile-checkout-btn">
                <i class="fas fa-truck"></i>
                <span>Âá∫Â∫´</span>
            </button>
        </div>
    </div>

    <!-- ========================================
         MAIN CONTAINER - iPad Grid Layout
         ======================================== -->
    <div class="main-container">
        <!-- UPPER SECTION (50vh) -->
        <div class="upper-section">

            <!-- ========================================
                 COLUMN 1: Search & Filter Panel (OPTIMIZED)
                 ======================================== -->
            <div class="panel search-filter-panel">
                <div class="panel-header">
                    <i class="fas fa-search"></i> Ê§úÁ¥¢„Éª„Éï„Ç£„É´„Çø
                </div>

                <div class="panel-body">
                    <!-- Category Tabs - COLOR CODED -->
                    <div class="category-tabs" id="category-tabs">
                        <button class="category-tab active" data-category="all">„Åô„Åπ„Å¶</button>
                        <button class="category-tab" data-category="mold">ÈáëÂûã</button>
                        <button class="category-tab" data-category="cutter">ÊäúÂûã</button>
                    </div>

                    <!-- Search Section - YELLOW HIGHLIGHT -->
                    <div class="search-section">
                        <label class="search-label">
                            Ê§úÁ¥¢
                            <span class="search-label-sub">T√¨m ki·∫øm</span>
                        </label>
                        <div class="search-box">
                            <input type="text" class="search-input" placeholder="„Ç≥„Éº„Éâ„ÉªÂêçÂâç„ÉªÂ†¥ÊâÄ..." id="search-input">
                            <button class="search-clear-btn" id="search-clear-btn"><i class="fas fa-times"></i></button>
                            <button class="qr-btn" id="qr-scan-btn"><i class="fas fa-qrcode"></i></button>
                        </div>
                    </div>

                    <!-- Filter Section - 2 DYNAMIC COMBOBOXES -->
                    <div class="filter-section">
                        <label class="filter-label">
                            „Éï„Ç£„É´„Çø„Éï„Ç£„Éº„É´„Éâ
                            <span class="search-label-sub">Ch·ªçn tr∆∞·ªùng l·ªçc</span>
                        </label>
                        <select class="filter-select" id="filter-field">
                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            <option value="MoldCode">ÈáëÂûã„Ç≥„Éº„Éâ</option>
                            <option value="MoldName">ÈáëÂûãÂêç</option>
                            <option value="CutterNo">ÊäúÂûãÁï™Âè∑</option>
                            <option value="CutterName">ÊäúÂûãÂêç</option>
                            <option value="CustomerName">È°ßÂÆ¢Âêç</option>
                            <option value="CompanyShortName">‰øùÁÆ°‰ºöÁ§æ</option>
                            <option value="RackLocation">‰øùÁÆ°Â†¥ÊâÄ</option>
                            <option value="MoldDesignDim">ÂØ∏Ê≥ï</option>
                            <option value="DateEntry">Ë£ΩÈÄ†Êó•</option>
                            <option value="MoldStatus">ÈáëÂûãÁä∂ÊÖã</option>
                            <option value="CutterEdgeStatus">ÊäúÂûãÂàÉÁä∂ÊÖã</option>
                        </select>

                        <label class="filter-label">
                            „Éï„Ç£„É´„ÇøÂÄ§
                            <span class="search-label-sub">Ch·ªçn gi√° tr·ªã</span>
                        </label>
                        <select class="filter-select" id="filter-value">
                            <option value="">„Åæ„Åö„Éï„Ç£„Éº„É´„Éâ„ÇíÈÅ∏Êäû</option>
                        </select>
                    </div>

                    <!-- Action Buttons - ƒê∆ØA L√äN TR∆Ø·ªöC ADVANCED -->
                    <div class="action-buttons">
                        <button class="btn btn-reset" id="filter-reset-btn">
                            <i class="fas fa-redo"></i> „Éï„Ç£„É´„Çø„É™„Çª„ÉÉ„Éà
                        </button>
                        <button class="btn btn-reset-all" id="reset-all-btn">
                            <i class="fas fa-fast-backward"></i> ÂÖ®„ÇØ„É™„Ç¢
                        </button>
                    </div>

                    <!-- Advanced Section - SCROLLABLE -->
                    <div class="advanced-section">
                        <div class="advanced-title">
                            È´òÂ∫¶„Å™Ê§úÁ¥¢
                            <span class="search-label-sub">T√¨m ki·∫øm n√¢ng cao</span>
                        </div>

                        <label class="filter-label">
                            ‰∏¶„Å≥Êõø„Åà
                            <span class="search-label-sub">S·∫Øp x·∫øp</span>
                        </label>
                        <select class="filter-select" id="sort-field">
                            <option value="">‰∏¶„Å≥Êõø„Åà...</option>
                            <option value="code">„Ç≥„Éº„Éâ</option>
                            <option value="name">ÂêçÂâç</option>
                            <option value="date">Ë£ΩÈÄ†Êó•</option>
                            <option value="dimension">ÂØ∏Ê≥ï</option>
                            <option value="location">‰øùÁÆ°Â†¥ÊâÄ</option>
                        </select>

                        <select class="filter-select" id="sort-order">
                            <option value="asc">ÊòáÈ†Ü (A‚ÜíZ)</option>
                            <option value="desc">ÈôçÈ†Ü (Z‚ÜíA)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- ========================================
                 COLUMN 2: Quick Results Panel (SINGLE COLUMN)
                 ======================================== -->
            <div class="panel quick-results-panel">
                <div class="panel-header">
                    <i class="fas fa-bolt"></i> „ÇØ„Ç§„ÉÉ„ÇØÁµêÊûú
                    <span class="result-count-badge" id="quick-count">0‰ª∂</span>
                </div>

                <div class="panel-body">
                    <!-- Results: Single column v·ªõi ƒë·∫ßy ƒë·ªß th√¥ng tin -->
                    <div class="quick-results-grid" id="quick-results-grid">
                        <!-- Results will be dynamically inserted here -->
                        <div class="empty-hint">Ê§úÁ¥¢ÁµêÊûú„Å™„Åó</div>
                    </div>
                </div>
            </div>

            <!-- ========================================
                 COLUMN 3: Detail Info Panel (SPLIT LAYOUT)
                 ======================================== -->
            <div class="panel detail-panel">
                <div class="panel-header">
                    <i class="fas fa-info-circle"></i> Ë©≥Á¥∞ÊÉÖÂ†±
                </div>

                <!-- UPPER 45%: Location Info -->
                <div class="detail-upper" id="detail-upper">
                    <!-- Row 1: Company + Status -->
                    <div class="detail-company-row">
                        <span class="company-name" id="detail-company">YSD</span>
                        <span class="detail-status status-available" id="detail-status">Âà©Áî®ÂèØËÉΩ</span>
                    </div>

                    <!-- Row 2: POS-Style Location (FLEXIBLE WIDTH) -->
                    <div class="location-display">
                        <!-- RackID Badge -->
                        <div class="location-badge-wrapper">
                            <div class="location-circle" id="detail-rack-id">6</div>
                            <div class="location-label">Ê£öÁï™Âè∑</div>
                        </div>
                        
                        <div class="location-divider">-</div>
                        
                        <!-- LayerNum Badge -->
                        <div class="location-badge-wrapper">
                            <div class="location-rectangle" id="detail-layer-num">2</div>
                            <div class="location-label">ÈöéÂ±§Áï™Âè∑</div>
                        </div>
                    </div>


                 <!-- Storage Group: Rack + Notes (2 columns) -->
                    <div class="detail-storage-group">
                    <div class="storage-item">
                        <span class="field-title">Ê£ö‰ΩçÁΩÆÔºö</span>
                        <span id="detail-rack-location">6Âè∑Ê©üÂÆ§-2</span>
                        <span class="divider">  </span>
                        <span id="detail-rack-notes"></span>
                    </div>
                    <div class="storage-item">
                        <span class="field-title">‰øùÁÆ°ÂÇôËÄÉÔºö</span>
                        <span id="detail-layer-notes">  </span>
                    </div>
                    </div>

                </div>

                <!-- LOWER: Basic Info (9 ROWS) -->
                <div class="detail-lower" id="detail-lower">
                    <!-- Row 1: Code + Name -->
                    <div class="detail-info-section">
                        <div class="detail-info-row">
                            <span class="detail-label">
                                „Ç≥„Éº„Éâ„ÉªÂêçÁß∞
                                <span class="detail-label-sub">M√£ v√† t√™n</span>
                            </span>
                            <span class="detail-value highlight" id="detail-code-name">TDW001R3</span>
                        </div>
                    </div>

                    <!-- Row 2: Dimensions + Weight -->
                    <div class="detail-info-section">
                        <div class="detail-info-row">
                            <span class="detail-label">
                                ÂØ∏Ê≥ï
                                <span class="detail-label-sub">K√≠ch th∆∞·ªõc</span>
                            </span>
                            <span class="detail-value" id="detail-dimensions">469√ó299√ó31.2</span>
                        </div>
                    </div>

                    <!-- Row 5: Tray Info -->
                    <div class="detail-info-section">
                        <div class="detail-info-row">
                            <span class="detail-label">
                                „Éà„É¨„Ç§ÊÉÖÂ†±
                                <span class="detail-label-sub">Th√¥ng tin khay</span>
                            </span>
                            <span class="detail-value" id="detail-tray">-</span>
                        </div>
                    </div>

                    <!-- Row 6: Plastic Type -->
                    <div class="detail-info-section">
                        <div class="detail-info-row">
                            <span class="detail-label">
                                Ê®πËÑÇ„Çø„Ç§„Éó
                                <span class="detail-label-sub">Lo·∫°i nh·ª±a</span>
                            </span>
                            <span class="detail-value" id="detail-plastic">-</span>
                        </div>
                    </div>

                    <!-- Row 7: Cut Dimensions -->
                    <div class="detail-info-section">
                        <div class="detail-info-row">
                            <span class="detail-label">
                                „Ç´„ÉÉ„ÉàÂØ∏Ê≥ï
                                <span class="detail-label-sub">K√≠ch th∆∞·ªõc c·∫Øt</span>
                            </span>
                            <span class="detail-value" id="detail-cutline">-</span>
                        </div>
                    </div>

                    <!-- Row 3: Manufacturing Date -->
                    <div class="detail-info-section">
                        <div class="detail-info-row">
                            <span class="detail-label">
                                Ë£ΩÈÄ†Êó•
                                <span class="detail-label-sub">Ng√†y s·∫£n xu·∫•t</span>
                            </span>
                            <span class="detail-value" id="detail-date">-</span>
                        </div>
                    </div>

                    <!-- Row 4: Notes -->
                    <div class="detail-info-section">
                        <div class="detail-info-row">
                            <span class="detail-label">
                                ÂÇôËÄÉ
                                <span class="detail-label-sub">Ghi ch√∫</span>
                            </span>
                            <span class="detail-value" id="detail-notes">-</span>
                        </div>
                    </div>

                    

                    <!-- Row 8: Teflon Status + Date -->
                    <div class="detail-info-section">
                        <div class="detail-info-row">
                            <span class="detail-label">
                                „ÉÜ„Éï„É≠„É≥Áä∂ÊÖã
                                <span class="detail-label-sub">Tr·∫°ng th√°i teflon</span>
                            </span>
                            <span class="detail-value" id="detail-teflon">-</span>
                        </div>
                    </div>

                    <!-- Row 9: Mold Returning/Disposing Status -->
                    <div class="detail-info-section">
                        <div class="detail-info-row">
                            <span class="detail-label">
                                Âá¶ÁêÜÁä∂ÊÖã
                                <span class="detail-label-sub">Tr·∫°ng th√°i x·ª≠ l√Ω</span>
                            </span>
                            <span class="detail-value" id="detail-processing">-</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ========================================
                 COLUMN 4: Actions Panel (SPLIT 60/40)
                 ======================================== -->
            <div class="panel actions-panel">
                <div class="panel-header">
                    <i class="fas fa-cogs"></i> Áä∂ÊÖã„ÉªÊìç‰Ωú
                </div>

                <!-- ƒê·ªìng b·ªô: d√πng panel-body cho to√†n b·ªô n√∫t -->
                <div class="panel-body actions-body">
                    <!-- Row 1 -->
                    <div class="actions-row-3col">
                    <button class="action-btn btn-location" id="location-btn">
                        <i class="action-icon fas fa-map-marker-alt"></i><span>‰ΩçÁΩÆÂ§âÊõ¥</span>
                    </button>
                    <button class="action-btn btn-shipment" id="shipment-btn">
                        <i class="action-icon fas fa-shipping-fast"></i><span>Âá∫Ëç∑ÁôªÈå≤</span>
                    </button>
                    <button class="action-btn btn-teflon" id="teflon-btn">
                        <i class="action-icon fas fa-flask"></i><span>„ÉÜ„Éï„É≠„É≥</span>
                    </button>
                    </div>

                    <!-- Row 2 -->
                    <div class="actions-row-3col">
                    <button class="action-btn btn-comment" id="comment-btn">
                        <i class="action-icon fas fa-comment"></i><span>„Ç≥„É°„É≥„Éà</span>
                    </button>
                    <button class="action-btn btn-print" id="print-btn">
                        <i class="action-icon fas fa-print"></i><span>Âç∞Âà∑ PDF</span>
                    </button>
                    <button class="action-btn btn-qr" id="export-qr-btn">
                        <i class="action-icon fas fa-qrcode"></i><span>QR„Ç≥„Éº„Éâ</span>
                    </button>
                    </div>

                    <!-- Row 3 -->
                    <div class="checkin-checkout-row">
                    <button class="action-btn-large btn-checkin" id="checkin-btn">
                        <span class="btn-text-main">ÂÖ•Â∫´</span><span class="btn-text-sub">Nh·∫≠p kho</span>
                    </button>
                    <button class="action-btn-large btn-checkout" id="checkout-btn">
                        <span class="btn-text-main">Âá∫Â∫´</span><span class="btn-text-sub">Xu·∫•t kho</span>
                    </button>
                    </div>
                
                <!-- Row 4: Toggle Button 
                <button class="toggle-view-btn" id="toggle-view-btn">
                    <i class="fas fa-keyboard"></i>
                    <span>„Ç≠„Éº„Éú„Éº„ÉâË°®Á§∫</span>
                </button>-->
            </div>

             <!-- Related Equipment -->
            <div class="actions-lower">
               <!--<div class="related-section">
                     <div class="related-header">
                        <span>
                            <i class="fas fa-link"></i> Èñ¢ÈÄ£Ë®≠ÂÇô
                        </span>
                        <span class="dedicated-cutter-badge" id="dedicated-cutter-badge">
                            Âà•Êäú„ÅçÔºö„Å™„Åó
                        </span>
                    </div>
                    <div class="related-list" id="related-list">
                        <div class="empty-hint">Èñ¢ÈÄ£Ë®≠ÂÇô„Å™„Åó</div>
                    </div>
                </div>-->
            </div>

            


                
            </div>

        </div> <!-- End Upper Section -->

        <!-- Lower section: L√†m s·∫°ch ho√†n to√†n theo ki·∫øn tr√∫c m·ªõi -->
    <section class="lower-section">
      <div class="panel lower-panel">
        <div class="lower-tabs">
          <button class="lower-tab" data-tab="results"><i class="fas fa-table"></i><span>‰∏ÄË¶ß / B·∫£ng</span></button>
          <button class="lower-tab" data-tab="detail"><i class="fas fa-list"></i><span>Ë©≥Á¥∞ / Chi ti·∫øt</span></button>
          <button class="lower-tab active" data-tab="keyboard"><i class="fas fa-keyboard"></i><span>„Ç≠„Éº„Éú„Éº„Éâ / B√†n ph√≠m</span><span class="tab-count" id="kb-toggle-badge">ON</span></button>
          <div style="margin-left:auto;display:flex;gap:6px;padding-right:8px;">
            <button class="btn" id="qr-scan-open"><i class="fas fa-qrcode"></i> QR</button>
          </div>
        </div>

        <div class="lower-content">

          <!-- Tab: „Ç≠„Éº„Éú„Éº„Éâ -->
          <div class="tab-pane active" id="keyboard-pane">
            <div class="keyboard-layout">
              <!-- Tr√°i: 1/2 l·ªãch s·ª≠, 1/2 g·ª£i √Ω -->
              <div class="keyboard-left">
                <div class="keyboard-section history-zone">
                  <h4>Â±•Ê≠¥ / L·ªãch s·ª≠</h4>
                  <div id="history-container">
                    <div id="history-chips"></div>
                  </div>
                </div>
                <div class="keyboard-section suggest-zone">
                  <h4>ÊèêÊ°à / G·ª£i √Ω</h4>
                  <div id="keyboard-suggest"></div>
                </div>
              </div>

              <!-- Gi·ªØa: B√†n ph√≠m ·∫£o -->
              <div class="keyboard-center">
                <div id="virtual-keyboard"></div>
              </div>

              <!-- Ph·∫£i: Nh·∫≠p nhanh (h·ªçc t·ª´ l·ªãch s·ª≠) -->
              <div class="keyboard-right">
                <h4>„ÇØ„Ç§„ÉÉ„ÇØÂÖ•Âäõ / Nh·∫≠p nhanh</h4>
                <div id="abbr-wrap" class="quick-phrases"></div>
                <button class="qr-scan-large" id="qr-scan-open"><i class="fas fa-qrcode"></i><span>QR„Çπ„Ç≠„É£„É≥ / Qu√©t QR</span></button>
              </div>
            </div>
          </div>

          <!-- Tab: ‰∏ÄË¶ß -->
          <div class="tab-pane" id="results-pane">
            <div class="table-wrap">
              <table class="results-table">
                <thead>
                  <tr>
                    <th>Á®ÆÂà• / Lo·∫°i</th>
                    <th>„Ç≥„Éº„Éâ / M√£</th>
                    <th>ÂêçÁß∞ / T√™n</th>
                    <th>ÂØ∏Ê≥ï / K√≠ch th∆∞·ªõc</th>
                    <th>‰øùÁÆ°Â†¥ÊâÄ / N∆°i l∆∞u</th>
                    <th>Áä∂ÊÖã / Tr·∫°ng th√°i</th>
                    <th>Êìç‰Ωú / Thao t√°c</th>
                  </tr>
                </thead>
                <tbody id="results-tbody"></tbody>
              </table>
            </div>
          </div>

          <!-- Tab: Ë©≥Á¥∞ -->
          <div class="tab-pane" id="detail-pane">
            <div class="detail-full-view" id="detail-info-body"></div>
          </div>

        </div>
      </div>

      <!-- QR Modal -->
      <div class="qr-modal hidden" id="qr-modal">
        <div class="qr-dialog">
          <div class="qr-header">
            <span>QR„Çπ„Ç≠„É£„Éä / M√°y qu√©t QR</span>
            <button class="btn btn-small" id="qr-close-btn"><i class="fas fa-times"></i></button>
          </div>
          <div id="qr-reader" class="qr-reader"></div>
        </div>
      </div>
    </section>

    

    <!-- ========================================
         JAVASCRIPT MODULES (Order matters!)
         ======================================== -->
    <!-- Core Modules -->
    <script src="data-manager.js"></script>
    <script src="app-controller.js"></script>
    <script src="ui-renderer.js"></script>
    

    <!-- Search Modules -->
    <script src="search-module.js"></script>

    <script src="search-ux-bridge.js"></script>

     <!--<script src="quick-results-highlight.js"></script>-->
    <script src="related-equipment.js"></script>
    <!-- <script src="ui-renderer-hook.js"></script>-->
    <script src="search-history-bridge.js"></script>
    <!-- <script src="search-history-panel.js"></script>-->
    <script src="filter-module.js"></script>
    <script src="search-history.js"></script>
    <!-- <script src="keyboard-shortcuts.js"></script>-->
    <script src="search-suggestions.js"></script>

    <!-- Input Modules -->
    <script src="lower-tabs.js"></script>
    <script src="qr-scanner.js"></script>

    <!-- Action Modules -->
    <script src="checkin-checkout.js"></script>
    <script src="location-update.js"></script>
    <script src="shipment.js"></script>
    <script src="comment-teflon.js"></script>

    <!-- Advanced Modules -->
    <script src="face-id.js"></script>
    <script src="export-qr.js"></script>
    <script src="print.js"></script>

    <!-- Initialization Script -->
    <script>
        // Wait for all modules to load
        window.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ V7.7.5-KIOSK-OPT Starting...');

            // All modules auto-initialize via their own init()
            // AppController orchestrates everything

            console.log('‚úÖ V7.7.5-KIOSK-OPT Ready!');
        });
    </script>
</body>
</html>