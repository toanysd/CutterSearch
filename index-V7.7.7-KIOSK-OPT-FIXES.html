<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>金型・抜型検索システム V7.7.7-KIOSK-OPT | Mold & Cutter Search System</title>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="styles-V7.7.7-KIOSK-OPT-FIXES.css">
    <link rel="stylesheet" href="keyboard-panel.css">
    <link rel="stylesheet" href="styles-lower-section.css" />


    <!-- External Libraries (CDN) -->
    <!-- QR Code Scanner (Html5-QRCode) -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>

    <!-- QR Code Generator -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <!-- ========================================
         HEADER - Desktop/iPad (OPTIMIZED)
         ======================================== -->
    <header class="app-header">
        <div class="header-title">
            <div class="title-main">
                <i class="fas fa-search"></i>
                <span>金型・抜型検索システム</span>
                <span class="version-badge">V7.7.5-OPT</span>
            </div>
            <!-- THAY ĐỔI: Tiếng Việt italic -->
            <div class="title-sub">Hệ thống tìm kiếm khuôn và dao cắt</div>
        </div>

        <div class="header-status">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span>準備完了</span>
            </div>
            <div class="status-counts">
                <span>金型: <strong id="mold-count">4518</strong></span>
                <span class="divider">|</span>
                <span>抜型: <strong id="cutter-count">1665</strong></span>
            </div>
        </div>
    </header>

    <!-- ========================================
         MOBILE STICKY HEADER (iPhone only)
         ======================================== -->
    <div class="mobile-header">
        <div class="mobile-search-row">
            <div class="mobile-search-box">
                <input type="text" class="mobile-search-input" placeholder="コード・名前・寸法で検索..." id="mobile-search-input">
                <button class="mobile-clear-btn" id="mobile-clear-btn"><i class="fas fa-times"></i></button>
            </div>
            <button class="mobile-qr-btn" id="mobile-qr-btn"><i class="fas fa-qrcode"></i></button>
        </div>

        <div class="mobile-actions-row">
            <button class="mobile-action-btn checkin" id="mobile-checkin-btn">
                <i class="fas fa-box"></i>
                <span>入庫</span>
            </button>
            <button class="mobile-action-btn checkout" id="mobile-checkout-btn">
                <i class="fas fa-truck"></i>
                <span>出庫</span>
            </button>
        </div>
    </div>

    <!-- ========================================
         MAIN CONTAINER - iPad Grid Layout
         ======================================== -->
    <div class="main-container">
        <!-- UPPER SECTION (50vh) -->
        <div class="upper-section">

            <!-- ========================================
                 COLUMN 1: Search & Filter Panel (OPTIMIZED)
                 ======================================== -->
            <div class="panel search-filter-panel">
                <div class="panel-header">
                    <i class="fas fa-search"></i> 検索・フィルタ
                </div>

                <div class="panel-body">
                    <!-- Category Tabs - COLOR CODED -->
                    <div class="category-tabs" id="category-tabs">
                        <button class="category-tab active" data-category="all">すべて</button>
                        <button class="category-tab" data-category="mold">金型</button>
                        <button class="category-tab" data-category="cutter">抜型</button>
                    </div>

                    <!-- Search Section - YELLOW HIGHLIGHT -->
                    <div class="search-section">
                        <label class="search-label">
                            検索
                            <span class="search-label-sub">Tìm kiếm</span>
                        </label>
                        <div class="search-box">
                            <input type="text" class="search-input" placeholder="コード・名前・場所..." id="search-input">
                            <button class="search-clear-btn" id="search-clear-btn"><i class="fas fa-times"></i></button>
                            <button class="qr-btn" id="qr-scan-btn"><i class="fas fa-qrcode"></i></button>
                        </div>
                    </div>

                    <!-- Filter Section - 2 DYNAMIC COMBOBOXES -->
                    <div class="filter-section">
                        <label class="filter-label">
                            フィルタフィールド
                            <span class="search-label-sub">Chọn trường lọc</span>
                        </label>
                        <select class="filter-select" id="filter-field">
                            <option value="">選択してください</option>
                            <option value="MoldCode">金型コード</option>
                            <option value="MoldName">金型名</option>
                            <option value="CutterNo">抜型番号</option>
                            <option value="CutterName">抜型名</option>
                            <option value="CustomerName">顧客名</option>
                            <option value="CompanyShortName">保管会社</option>
                            <option value="RackLocation">保管場所</option>
                            <option value="MoldDesignDim">寸法</option>
                            <option value="DateEntry">製造日</option>
                            <option value="MoldStatus">金型状態</option>
                            <option value="CutterEdgeStatus">抜型刃状態</option>
                        </select>

                        <label class="filter-label">
                            フィルタ値
                            <span class="search-label-sub">Chọn giá trị</span>
                        </label>
                        <select class="filter-select" id="filter-value">
                            <option value="">まずフィールドを選択</option>
                        </select>
                    </div>

                    <!-- Action Buttons - ĐƯA LÊN TRƯỚC ADVANCED -->
                    <div class="action-buttons">
                        <button class="btn btn-reset" id="filter-reset-btn">
                            <i class="fas fa-redo"></i> フィルタリセット
                        </button>
                        <button class="btn btn-reset-all" id="reset-all-btn">
                            <i class="fas fa-fast-backward"></i> 全クリア
                        </button>
                    </div>

                    <!-- Advanced Section - SCROLLABLE -->
                    <div class="advanced-section">
                        <div class="advanced-title">
                            高度な検索
                            <span class="search-label-sub">Tìm kiếm nâng cao</span>
                        </div>

                        <label class="filter-label">
                            並び替え
                            <span class="search-label-sub">Sắp xếp</span>
                        </label>
                        <select class="filter-select" id="sort-field">
                            <option value="">並び替え...</option>
                            <option value="code">コード</option>
                            <option value="name">名前</option>
                            <option value="date">製造日</option>
                            <option value="dimension">寸法</option>
                            <option value="location">保管場所</option>
                        </select>

                        <select class="filter-select" id="sort-order">
                            <option value="asc">昇順 (A→Z)</option>
                            <option value="desc">降順 (Z→A)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- ========================================
                 COLUMN 2: Quick Results Panel (SINGLE COLUMN)
                 ======================================== -->
            <div class="panel quick-results-panel">
                <div class="panel-header">
                    <i class="fas fa-bolt"></i> クイック結果
                    <span class="result-count-badge" id="quick-count">0件</span>
                </div>

                <div class="panel-body">
                    <!-- Results: Single column với đầy đủ thông tin -->
                    <div class="quick-results-grid" id="quick-results-grid">
                        <!-- Results will be dynamically inserted here -->
                        <div class="empty-hint">検索結果なし</div>
                    </div>
                </div>
            </div>

            <!-- ========================================
                 COLUMN 3: Detail Info Panel (SPLIT LAYOUT)
                 ======================================== -->
            <div class="panel detail-panel">
                <div class="panel-header">
                    <i class="fas fa-info-circle"></i> 詳細情報
                </div>

                <!-- UPPER 45%: Location Info -->
                <div class="detail-upper" id="detail-upper">
                    <!-- Row 1: Company + Status -->
                    <div class="detail-company-row">
                        <span class="company-name" id="detail-company">YSD</span>
                        <span class="detail-status status-available" id="detail-status">利用可能</span>
                    </div>

                    <!-- Row 2: POS-Style Location (FLEXIBLE WIDTH) -->
                    <div class="location-display">
                        <!-- RackID Badge -->
                        <div class="location-badge-wrapper">
                            <div class="location-circle" id="detail-rack-id">6</div>
                            <div class="location-label">棚番号</div>
                        </div>
                        
                        <div class="location-divider">-</div>
                        
                        <!-- LayerNum Badge -->
                        <div class="location-badge-wrapper">
                            <div class="location-rectangle" id="detail-layer-num">2</div>
                            <div class="location-label">階層番号</div>
                        </div>
                    </div>


                 <!-- Storage Group: Rack + Notes (2 columns) -->
                    <div class="detail-storage-group">
                    <div class="storage-item">
                        <span class="field-title">棚位置：</span>
                        <span id="detail-rack-location">6号機室-2</span>
                        <span class="divider">  </span>
                        <span id="detail-rack-notes"></span>
                    </div>
                    <div class="storage-item">
                        <span class="field-title">保管備考：</span>
                        <span id="detail-layer-notes">  </span>
                    </div>
                    </div>

                </div>

                <!-- LOWER: Basic Info (9 ROWS) -->
                <div class="detail-lower" id="detail-lower">
                    <!-- Row 1: Code + Name -->
                    <div class="detail-info-section">
                        <div class="detail-info-row">
                            <span class="detail-label">
                                コード・名称
                                <span class="detail-label-sub">Mã và tên</span>
                            </span>
                            <span class="detail-value highlight" id="detail-code-name">TDW001R3</span>
                        </div>
                    </div>

                    <!-- Row 2: Dimensions + Weight -->
                    <div class="detail-info-section">
                        <div class="detail-info-row">
                            <span class="detail-label">
                                寸法
                                <span class="detail-label-sub">Kích thước</span>
                            </span>
                            <span class="detail-value" id="detail-dimensions">469×299×31.2</span>
                        </div>
                    </div>

                    <!-- Row 5: Tray Info -->
                    <div class="detail-info-section">
                        <div class="detail-info-row">
                            <span class="detail-label">
                                トレイ情報
                                <span class="detail-label-sub">Thông tin khay</span>
                            </span>
                            <span class="detail-value" id="detail-tray">-</span>
                        </div>
                    </div>

                    <!-- Row 6: Plastic Type -->
                    <div class="detail-info-section">
                        <div class="detail-info-row">
                            <span class="detail-label">
                                樹脂タイプ
                                <span class="detail-label-sub">Loại nhựa</span>
                            </span>
                            <span class="detail-value" id="detail-plastic">-</span>
                        </div>
                    </div>

                    <!-- Row 7: Cut Dimensions -->
                    <div class="detail-info-section">
                        <div class="detail-info-row">
                            <span class="detail-label">
                                カット寸法
                                <span class="detail-label-sub">Kích thước cắt</span>
                            </span>
                            <span class="detail-value" id="detail-cutline">-</span>
                        </div>
                    </div>

                    <!-- Row 3: Manufacturing Date -->
                    <div class="detail-info-section">
                        <div class="detail-info-row">
                            <span class="detail-label">
                                製造日
                                <span class="detail-label-sub">Ngày sản xuất</span>
                            </span>
                            <span class="detail-value" id="detail-date">-</span>
                        </div>
                    </div>

                    <!-- Row 4: Notes -->
                    <div class="detail-info-section">
                        <div class="detail-info-row">
                            <span class="detail-label">
                                備考
                                <span class="detail-label-sub">Ghi chú</span>
                            </span>
                            <span class="detail-value" id="detail-notes">-</span>
                        </div>
                    </div>

                    

                    <!-- Row 8: Teflon Status + Date -->
                    <div class="detail-info-section">
                        <div class="detail-info-row">
                            <span class="detail-label">
                                テフロン状態
                                <span class="detail-label-sub">Trạng thái teflon</span>
                            </span>
                            <span class="detail-value" id="detail-teflon">-</span>
                        </div>
                    </div>

                    <!-- Row 9: Mold Returning/Disposing Status -->
                    <div class="detail-info-section">
                        <div class="detail-info-row">
                            <span class="detail-label">
                                処理状態
                                <span class="detail-label-sub">Trạng thái xử lý</span>
                            </span>
                            <span class="detail-value" id="detail-processing">-</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ========================================
                 COLUMN 4: Actions Panel (SPLIT 60/40)
                 ======================================== -->
            <div class="panel actions-panel">
                <div class="panel-header">
                    <i class="fas fa-cogs"></i> 状態・操作
                </div>

                <!-- Đồng bộ: dùng panel-body cho toàn bộ nút -->
                <div class="panel-body actions-body">
                    <!-- Row 1 -->
                    <div class="actions-row-3col">
                    <button class="action-btn btn-location" id="location-btn">
                        <i class="action-icon fas fa-map-marker-alt"></i><span>位置変更</span>
                    </button>
                    <button class="action-btn btn-shipment" id="shipment-btn">
                        <i class="action-icon fas fa-shipping-fast"></i><span>出荷登録</span>
                    </button>
                    <button class="action-btn btn-teflon" id="teflon-btn">
                        <i class="action-icon fas fa-flask"></i><span>テフロン</span>
                    </button>
                    </div>

                    <!-- Row 2 -->
                    <div class="actions-row-3col">
                    <button class="action-btn btn-comment" id="comment-btn">
                        <i class="action-icon fas fa-comment"></i><span>コメント</span>
                    </button>
                    <button class="action-btn btn-print" id="print-btn">
                        <i class="action-icon fas fa-print"></i><span>印刷 PDF</span>
                    </button>
                    <button class="action-btn btn-qr" id="export-qr-btn">
                        <i class="action-icon fas fa-qrcode"></i><span>QRコード</span>
                    </button>
                    </div>

                    <!-- Row 3 -->
                    <div class="checkin-checkout-row">
                    <button class="action-btn-large btn-checkin" id="checkin-btn">
                        <span class="btn-text-main">入庫</span><span class="btn-text-sub">Nhập kho</span>
                    </button>
                    <button class="action-btn-large btn-checkout" id="checkout-btn">
                        <span class="btn-text-main">出庫</span><span class="btn-text-sub">Xuất kho</span>
                    </button>
                    </div>
                
                <!-- Row 4: Toggle Button 
                <button class="toggle-view-btn" id="toggle-view-btn">
                    <i class="fas fa-keyboard"></i>
                    <span>キーボード表示</span>
                </button>-->
            </div>

             <!-- Related Equipment -->
            <div class="actions-lower">
               <!--<div class="related-section">
                     <div class="related-header">
                        <span>
                            <i class="fas fa-link"></i> 関連設備
                        </span>
                        <span class="dedicated-cutter-badge" id="dedicated-cutter-badge">
                            別抜き：なし
                        </span>
                    </div>
                    <div class="related-list" id="related-list">
                        <div class="empty-hint">関連設備なし</div>
                    </div>
                </div>-->
            </div>

            


                
            </div>

        </div> <!-- End Upper Section -->

        <!-- Lower section: Làm sạch hoàn toàn theo kiến trúc mới -->
    <section class="lower-section">
      <div class="panel lower-panel">
        <div class="lower-tabs">
          <button class="lower-tab" data-tab="results"><i class="fas fa-table"></i><span>一覧 / Bảng</span></button>
          <button class="lower-tab" data-tab="detail"><i class="fas fa-list"></i><span>詳細 / Chi tiết</span></button>
          <button class="lower-tab active" data-tab="keyboard"><i class="fas fa-keyboard"></i><span>キーボード / Bàn phím</span><span class="tab-count" id="kb-toggle-badge">ON</span></button>
          <div style="margin-left:auto;display:flex;gap:6px;padding-right:8px;">
            <button class="btn" id="qr-scan-open"><i class="fas fa-qrcode"></i> QR</button>
          </div>
        </div>

        <div class="lower-content">

          <!-- Tab: キーボード -->
          <div class="tab-pane active" id="keyboard-pane">
            <div class="keyboard-layout">
              <!-- Trái: 1/2 lịch sử, 1/2 gợi ý -->
              <div class="keyboard-left">
                <div class="keyboard-section history-zone">
                  <h4>履歴 / Lịch sử</h4>
                  <div id="history-container">
                    <div id="history-chips"></div>
                  </div>
                </div>
                <div class="keyboard-section suggest-zone">
                  <h4>提案 / Gợi ý</h4>
                  <div id="keyboard-suggest"></div>
                </div>
              </div>

              <!-- Giữa: Bàn phím ảo -->
              <div class="keyboard-center">
                <div id="virtual-keyboard"></div>
              </div>

              <!-- Phải: Nhập nhanh (học từ lịch sử) -->
              <div class="keyboard-right">
                <h4>クイック入力 / Nhập nhanh</h4>
                <div id="abbr-wrap" class="quick-phrases"></div>
                <button class="qr-scan-large" id="qr-scan-open"><i class="fas fa-qrcode"></i><span>QRスキャン / Quét QR</span></button>
              </div>
            </div>
          </div>

          <!-- Tab: 一覧 -->
          <div class="tab-pane" id="results-pane">
            <div class="table-wrap">
              <table class="results-table">
                <thead>
                  <tr>
                    <th>種別 / Loại</th>
                    <th>コード / Mã</th>
                    <th>名称 / Tên</th>
                    <th>寸法 / Kích thước</th>
                    <th>保管場所 / Nơi lưu</th>
                    <th>状態 / Trạng thái</th>
                    <th>操作 / Thao tác</th>
                  </tr>
                </thead>
                <tbody id="results-tbody"></tbody>
              </table>
            </div>
          </div>

          <!-- Tab: 詳細 -->
          <div class="tab-pane" id="detail-pane">
            <div class="detail-full-view" id="detail-info-body"></div>
          </div>

        </div>
      </div>

      <!-- QR Modal -->
      <div class="qr-modal hidden" id="qr-modal">
        <div class="qr-dialog">
          <div class="qr-header">
            <span>QRスキャナ / Máy quét QR</span>
            <button class="btn btn-small" id="qr-close-btn"><i class="fas fa-times"></i></button>
          </div>
          <div id="qr-reader" class="qr-reader"></div>
        </div>
      </div>
    </section>

    

    <!-- ========================================
         JAVASCRIPT MODULES (Order matters!)
         ======================================== -->
    <!-- Core Modules -->
    <script src="data-manager.js"></script>
    <script src="app-controller.js"></script>
    <script src="ui-renderer.js"></script>
    

    <!-- Search Modules -->
    <script src="search-module.js"></script>

    <script src="search-ux-bridge.js"></script>

     <!--<script src="quick-results-highlight.js"></script>-->
    <script src="related-equipment.js"></script>
    <!-- <script src="ui-renderer-hook.js"></script>-->
    <script src="search-history-bridge.js"></script>
    <!-- <script src="search-history-panel.js"></script>-->
    <script src="filter-module.js"></script>
    <script src="search-history.js"></script>
    <!-- <script src="keyboard-shortcuts.js"></script>-->
    <script src="search-suggestions.js"></script>

    <!-- Input Modules -->
    <script src="lower-tabs.js"></script>
    <script src="qr-scanner.js"></script>

    <!-- Action Modules -->
    <script src="checkin-checkout.js"></script>
    <script src="location-update.js"></script>
    <script src="shipment.js"></script>
    <script src="comment-teflon.js"></script>

    <!-- Advanced Modules -->
    <script src="face-id.js"></script>
    <script src="export-qr.js"></script>
    <script src="print.js"></script>

    <!-- Initialization Script -->
    <script>
        // Wait for all modules to load
        window.addEventListener('DOMContentLoaded', () => {
            console.log('🚀 V7.7.5-KIOSK-OPT Starting...');

            // All modules auto-initialize via their own init()
            // AppController orchestrates everything

            console.log('✅ V7.7.5-KIOSK-OPT Ready!');
        });
    </script>
</body>
</html>